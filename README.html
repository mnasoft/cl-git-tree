<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
<!-- 2025-12-05 Пт 23:16 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>cl-git-tree</title>
<meta name="author" content="Mykola Matvyeyev" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">cl-git-tree</h1>
<div id="table-of-contents" role="doc-toc">
<h2>&#1057;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1085;&#1080;&#1077;</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orged0b2d9">1. Описание</a></li>
<li><a href="#org2236fff">2. Возможности</a>
<ul>
<li><a href="#orgba8e50f">2.1. Управление локациями</a></li>
<li><a href="#org69053e0">2.2. Синхронизация репозиториев</a></li>
<li><a href="#org9ea0d3c">2.3. Git-операции</a></li>
<li><a href="#org334c872">2.4. Конфигурация и вспомогательные команды</a></li>
</ul>
</li>
<li><a href="#org8825c19">3. Архитектура</a>
<ul>
<li><a href="#org071c90b">3.1. Основные компоненты</a></li>
<li><a href="#org99bce36">3.2. Данные и конфигурация</a></li>
<li><a href="#org02422fa">3.3. Паттерны проектирования</a></li>
</ul>
</li>
<li><a href="#orgb532dc5">4. Установка</a>
<ul>
<li><a href="#orgb25fd18">4.1. Через Quicklisp</a></li>
<li><a href="#org01d4c74">4.2. Из локального исходника</a></li>
</ul>
</li>
<li><a href="#orgd1f5a04">5. Использование</a>
<ul>
<li><a href="#org312da89">5.1. Примеры в Lisp API</a></li>
<li><a href="#org185a6ec">5.2. Примеры в CLI</a></li>
<li><a href="#org6e2f6b7">5.3. Конфигурация</a></li>
</ul>
</li>
<li><a href="#org1c00d7f">6. Справочник команд</a>
<ul>
<li><a href="#orge461949">6.1. Подкоманды remote</a></li>
</ul>
</li>
<li><a href="#orge092a64">7. Тестирование</a>
<ul>
<li><a href="#org59b11bd">7.1. Покрытие тестами</a></li>
</ul>
</li>
<li><a href="#org8e69e94">8. Разработка</a>
<ul>
<li><a href="#orgdea9d23">8.1. Структура проекта</a></li>
<li><a href="#orgb078b11">8.2. Добавление новой команды</a></li>
<li><a href="#org75dfb24">8.3. Запуск тестов с покрытием</a></li>
</ul>
</li>
<li><a href="#orga0deb06">9. Лицензия</a></li>
</ul>
</div>
</div>
<div id="outline-container-orged0b2d9" class="outline-2">
<h2 id="orged0b2d9"><span class="section-number-2">1.</span> Описание</h2>
<div class="outline-text-2" id="text-1">
<p>
cl-git-tree — инструмент для управления git‑локациями и синхронизации репозиториев,
написанный на Common Lisp.  
Он позволяет регистрировать шаблоны локаций (локальные пути, GitHub, GitLab),
строить URL для репозиториев, автоматизировать операции clone/unclone и управлять
удалёнными репозиториями через CLI или Lisp API.
</p>
</div>
</div>
<div id="outline-container-org2236fff" class="outline-2">
<h2 id="org2236fff"><span class="section-number-2">2.</span> Возможности</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgba8e50f" class="outline-3">
<h3 id="orgba8e50f"><span class="section-number-3">2.1.</span> Управление локациями</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>Регистрация и хранение локаций в глобальной таблице <code>*locations*</code>.</li>
<li>Поддержка трёх типов провайдеров:
<ul class="org-ul">
<li><code>:local</code> — локальные пути для git‑репозиториев.</li>
<li><code>:github</code> — публичные репозитории на GitHub (шаблон <code>git@github.com:username/</code>).</li>
<li><code>:gitlab</code> — публичные репозитории на GitLab (шаблон <code>git@gitlab.com:username/</code>).</li>
</ul></li>
<li>Нормализация и валидация URL при добавлении локаций.</li>
<li>Сохранение/загрузка конфигурации из файла <code>~/.git-tree/locations.lisp</code>.</li>
</ul>
</div>
</div>
<div id="outline-container-org69053e0" class="outline-3">
<h3 id="org69053e0"><span class="section-number-3">2.2.</span> Синхронизация репозиториев</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>Локальное клонирование репозиториев из известных локаций (<code>clone</code> / <code>unclone</code>).</li>
<li>Синхронизация с удалёнными хостами (<code>clone-remote</code> / <code>unclone-remote</code>).</li>
<li>Создание bare‑репозиториев на локальных хостах или удалённых серверах (<code>remote create</code> / <code>remote-create</code>).</li>
</ul>
</div>
</div>
<div id="outline-container-org9ea0d3c" class="outline-3">
<h3 id="org9ea0d3c"><span class="section-number-3">2.3.</span> Git-операции</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>Управление файлами в репозиториях: <code>add</code>, <code>commit</code>.</li>
<li>Синхронизация ветвей: <code>pull</code>, <code>push</code>.</li>
<li>Управление remotes: <code>remote add</code>, <code>remote remove</code>, <code>remote readd</code>, <code>remote create</code>, <code>remote delete</code>.</li>
<li>Просмотр статуса репозиториев: <code>status</code>.</li>
</ul>
</div>
</div>
<div id="outline-container-org334c872" class="outline-3">
<h3 id="org334c872"><span class="section-number-3">2.4.</span> Конфигурация и вспомогательные команды</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>Управление локациями: <code>locations list/show/add/edit/remove/save</code>.</li>
<li>Управление шаблонами файлов для отслеживания: <code>patterns</code>.</li>
<li>Показать информацию о системе: <code>info</code>.</li>
<li>Просмотр команд и их алиасов: <code>aliases</code>.</li>
<li>Универсальное применение операций ко всем репозиториям: <code>all</code> (pull → add → commit → push).</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org8825c19" class="outline-2">
<h2 id="org8825c19"><span class="section-number-2">3.</span> Архитектура</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org071c90b" class="outline-3">
<h3 id="org071c90b"><span class="section-number-3">3.1.</span> Основные компоненты</h3>
<div class="outline-text-3" id="text-3-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Модуль</th>
<th scope="col" class="org-left">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>cl-git-tree</code></td>
<td class="org-left">Основная система, координирующая подсистемы.</td>
</tr>

<tr>
<td class="org-left"><code>cl-git-tree/loc</code></td>
<td class="org-left">Управление локациями: классы <code>&lt;location&gt;</code>, <code>&lt;provider&gt;</code>, <code>&lt;local&gt;</code>, <code>&lt;github&gt;</code>, <code>&lt;gitlab&gt;</code> и API (<code>add-location</code>, <code>find-location</code>, <code>repo-url</code> и т.д.). Глобальный реестр <code>*locations*</code>.</td>
</tr>

<tr>
<td class="org-left"><code>cl-git-tree/dispatch</code></td>
<td class="org-left">Диспетчер CLI-команд, реестр <code>*commands*</code> и функция <code>dispatch-command</code>.</td>
</tr>

<tr>
<td class="org-left"><code>cl-git-tree/cli</code></td>
<td class="org-left">Точка входа (функция <code>main</code>), вывод справки.</td>
</tr>

<tr>
<td class="org-left"><code>cl-git-tree/fs</code></td>
<td class="org-left">Утилиты для работы с файловой системой: поиск git‑репозиториев (<code>find-git-repos</code>), проверка репозиториев (<code>git-repo-p</code>).</td>
</tr>

<tr>
<td class="org-left"><code>cl-git-tree/git-utils</code></td>
<td class="org-left">Обёртки для git-команд: <code>git-run</code>, <code>current-branch</code>, <code>repo-remotes</code>.</td>
</tr>

<tr>
<td class="org-left"><code>cl-git-tree/shell-utils</code></td>
<td class="org-left">Утилиты для вызова shell-команд и работы с SSH.</td>
</tr>

<tr>
<td class="org-left"><code>cl-git-tree/commands/*</code></td>
<td class="org-left">Набор из 20+ CLI-команд, регистрируемых автоматически при загрузке.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org99bce36" class="outline-3">
<h3 id="org99bce36"><span class="section-number-3">3.2.</span> Данные и конфигурация</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Глобальная таблица <b>locations</b> (hash-table) — хранит все зарегистрированные локации.</li>
<li>Файл конфигурации: <code>~/.git-tree/locations.lisp</code> — содержит формы <code>(add-location ...)</code> для загрузки при старте.</li>
<li>Файл шаблонов: <code>~/.git-tree/file-patterns.lisp</code> — регулярные выражения для фильтрации файлов при синхронизации.</li>
</ul>
</div>
</div>
<div id="outline-container-org02422fa" class="outline-3">
<h3 id="org02422fa"><span class="section-number-3">3.3.</span> Паттерны проектирования</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li><b>Полиморфизм через провайдеры</b>: методы <code>remote-create</code>, <code>repo-add</code> и т.д. диспетчеризуются по типу провайдера (<code>&lt;local&gt;</code>, <code>&lt;github&gt;</code>, <code>&lt;gitlab&gt;</code>).</li>
<li><b>Реестры команд</b>: CLI-команды регистрируются в <code>*commands*</code> при загрузке модулей.</li>
<li><b>Глобальное состояние</b>: <code>*locations*</code> и <code>*commands*</code> позволяют модулям регистрировать себя и друг друга без явной передачи параметров.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgb532dc5" class="outline-2">
<h2 id="orgb532dc5"><span class="section-number-2">4.</span> Установка</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgb25fd18" class="outline-3">
<h3 id="orgb25fd18"><span class="section-number-3">4.1.</span> Через Quicklisp</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-lisp">(ql:quickload <span style="color: #79a8ff;">"cl-git-tree"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org01d4c74" class="outline-3">
<h3 id="org01d4c74"><span class="section-number-3">4.2.</span> Из локального исходника</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d8af7a;"># </span><span style="color: #d8af7a;">&#1059;&#1073;&#1077;&#1076;&#1080;&#1090;&#1077;&#1089;&#1100;, &#1095;&#1090;&#1086; &#1087;&#1088;&#1086;&#1077;&#1082;&#1090; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1074; ~/quicklisp/local-projects/clisp/cl-git-tree/
</span><span style="color: #f78fe7;">cd</span> ~/quicklisp/local-projects/clisp/cl-git-tree
sbcl --eval <span style="color: #79a8ff;">"(progn (require 'asdf) (asdf:load-system :cl-git-tree))"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd1f5a04" class="outline-2">
<h2 id="orgd1f5a04"><span class="section-number-2">5.</span> Использование</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org312da89" class="outline-3">
<h3 id="org312da89"><span class="section-number-3">5.1.</span> Примеры в Lisp API</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Регистрация локаций и построение URL:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(cl-git-tree/loc:add-location <span style="color: #79a8ff;">"gh"</span>
  <span style="color: #f78fe7;">:description</span> <span style="color: #79a8ff;">"GitHub &#8212; &#1096;&#1072;&#1073;&#1083;&#1086;&#1085; &#1076;&#1083;&#1103; &#1087;&#1091;&#1073;&#1083;&#1080;&#1095;&#1085;&#1099;&#1093; &#1087;&#1088;&#1086;&#1077;&#1082;&#1090;&#1086;&#1074;"</span>
  <span style="color: #f78fe7;">:url-git</span> <span style="color: #79a8ff;">"git@github.com:username/"</span>
  <span style="color: #f78fe7;">:provider</span> <span style="color: #f78fe7;">:github</span>)

(cl-git-tree/loc:add-location <span style="color: #79a8ff;">"lc"</span>
  <span style="color: #f78fe7;">:description</span> <span style="color: #79a8ff;">"Local mirror"</span>
  <span style="color: #f78fe7;">:url-git</span> <span style="color: #79a8ff;">"/home/user/.git-tree/git/lc/"</span>
  <span style="color: #f78fe7;">:provider</span> <span style="color: #f78fe7;">:local</span>)

<span style="color: #d8af7a;">;; </span><span style="color: #d8af7a;">&#1055;&#1086;&#1089;&#1090;&#1088;&#1086;&#1077;&#1085;&#1080;&#1077; URL &#1088;&#1077;&#1087;&#1086;&#1079;&#1080;&#1090;&#1086;&#1088;&#1080;&#1103;
</span>(cl-git-tree/loc:repo-url <span style="color: #79a8ff;">"gh"</span> <span style="color: #79a8ff;">"cl-git-tree"</span>)
<span style="color: #d8af7a;">;; </span><span style="color: #d8af7a;">=&gt; "git@github.com:username/cl-git-tree.git"
</span>
<span style="color: #d8af7a;">;; </span><span style="color: #d8af7a;">&#1055;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &#1083;&#1086;&#1082;&#1072;&#1094;&#1080;&#1080;
</span>(cl-git-tree/loc:find-location <span style="color: #79a8ff;">"lc"</span>)
<span style="color: #d8af7a;">;; </span><span style="color: #d8af7a;">=&gt; #&lt;CL-GIT-TREE/LOC:&lt;LOCAL&gt; id="lc" ...&gt;
</span>
<span style="color: #d8af7a;">;; </span><span style="color: #d8af7a;">&#1057;&#1087;&#1080;&#1089;&#1086;&#1082; &#1074;&#1089;&#1077;&#1093; &#1083;&#1086;&#1082;&#1072;&#1094;&#1080;&#1081;
</span>(cl-git-tree/loc:all-location-keys)
<span style="color: #d8af7a;">;; </span><span style="color: #d8af7a;">=&gt; ("gh" "lc")</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org185a6ec" class="outline-3">
<h3 id="org185a6ec"><span class="section-number-3">5.2.</span> Примеры в CLI</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Использование из командной строки через SBCL:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d8af7a;"># </span><span style="color: #d8af7a;">&#1055;&#1086;&#1082;&#1072;&#1079;&#1072;&#1090;&#1100; &#1089;&#1087;&#1088;&#1072;&#1074;&#1082;&#1091;
</span>sbcl --eval <span style="color: #79a8ff;">"(progn (require 'asdf) (asdf:load-system :cl-git-tree) (cl-git-tree/cli:main '(\"prog\" \"--help\")))"</span> --quit

<span style="color: #d8af7a;"># </span><span style="color: #d8af7a;">&#1055;&#1086;&#1082;&#1072;&#1079;&#1072;&#1090;&#1100; &#1089;&#1087;&#1080;&#1089;&#1086;&#1082; &#1083;&#1086;&#1082;&#1072;&#1094;&#1080;&#1081;
</span>sbcl --eval <span style="color: #79a8ff;">"(progn (require 'asdf) (asdf:load-system :cl-git-tree) (cl-git-tree/cli:main '(\"prog\" \"locations\" \"list\")))"</span> --quit

<span style="color: #d8af7a;"># </span><span style="color: #d8af7a;">&#1044;&#1086;&#1073;&#1072;&#1074;&#1080;&#1090;&#1100; &#1083;&#1086;&#1082;&#1072;&#1094;&#1080;&#1102;
</span>sbcl --eval <span style="color: #79a8ff;">"(progn (require 'asdf) (asdf:load-system :cl-git-tree) (cl-git-tree/cli:main '(\"prog\" \"locations\" \"add\" \"myrepo\" \":url-git\" \"/tmp/repos\")))"</span> --quit

<span style="color: #d8af7a;"># </span><span style="color: #d8af7a;">&#1050;&#1083;&#1086;&#1085;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100; &#1088;&#1077;&#1087;&#1086;&#1079;&#1080;&#1090;&#1086;&#1088;&#1080;&#1081; &#1080;&#1079; &#1083;&#1086;&#1082;&#1072;&#1094;&#1080;&#1080;
</span>sbcl --eval <span style="color: #79a8ff;">"(progn (require 'asdf) (asdf:load-system :cl-git-tree) (cl-git-tree/cli:main '(\"prog\" \"clone\" \"gh\" \"cl-git-tree\")))"</span> --quit
</pre>
</div>
</div>
</div>
<div id="outline-container-org6e2f6b7" class="outline-3">
<h3 id="org6e2f6b7"><span class="section-number-3">5.3.</span> Конфигурация</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Автоматическая загрузка локаций при старте:
</p>
<ul class="org-ul">
<li>Создайте файл <code>~/.git-tree/locations.lisp</code> содержащий формы <code>(add-location ...)</code>:</li>
</ul>
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #b6a0ff;">in-package</span> <span style="color: #f78fe7;">:cl-git-tree/loc</span>)

(add-location <span style="color: #79a8ff;">"gh"</span>
  <span style="color: #f78fe7;">:description</span> <span style="color: #79a8ff;">"GitHub"</span>
  <span style="color: #f78fe7;">:url-git</span> <span style="color: #79a8ff;">"git@github.com:mnasoft/"</span>
  <span style="color: #f78fe7;">:provider</span> <span style="color: #f78fe7;">:github</span>)

(add-location <span style="color: #79a8ff;">"lc"</span>
  <span style="color: #f78fe7;">:description</span> <span style="color: #79a8ff;">"Local mirror"</span>
  <span style="color: #f78fe7;">:url-git</span> #p<span style="color: #79a8ff;">"/home/mna/.git-tree/git/lc/"</span>
  <span style="color: #f78fe7;">:provider</span> <span style="color: #f78fe7;">:local</span>)
</pre>
</div>

<ul class="org-ul">
<li>Функция <code>cl-git-tree:load-config</code> автоматически загружает этот файл при старте системы.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1c00d7f" class="outline-2">
<h2 id="org1c00d7f"><span class="section-number-2">6.</span> Справочник команд</h2>
<div class="outline-text-2" id="text-6">
<p>
Полный список доступных CLI-команд:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Команда</th>
<th scope="col" class="org-left">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>add</code></td>
<td class="org-left">Добавить файлы в индекс</td>
</tr>

<tr>
<td class="org-left"><code>clone</code></td>
<td class="org-left">Клонировать все локальные репозитории</td>
</tr>

<tr>
<td class="org-left"><code>commit</code></td>
<td class="org-left">Сделать git commit во всех репозиториях</td>
</tr>

<tr>
<td class="org-left"><code>pull</code></td>
<td class="org-left">Выполнить git pull во всех репозиториях</td>
</tr>

<tr>
<td class="org-left"><code>push</code></td>
<td class="org-left">Выполнить git push во всех репозиториях</td>
</tr>

<tr>
<td class="org-left"><code>status</code></td>
<td class="org-left">Показать git status во всех репозиториях</td>
</tr>

<tr>
<td class="org-left"><code>all</code></td>
<td class="org-left">Выполнить pull → add → commit → push</td>
</tr>

<tr>
<td class="org-left"><code>remote</code></td>
<td class="org-left">Управление remote (add/remove/readd/create/delete/list)</td>
</tr>

<tr>
<td class="org-left"><code>locations</code></td>
<td class="org-left">Управление локациями (list/show/add/edit/remove/save)</td>
</tr>

<tr>
<td class="org-left"><code>patterns</code></td>
<td class="org-left">Управление паттернами файлов</td>
</tr>

<tr>
<td class="org-left"><code>aliases</code></td>
<td class="org-left">Показать git-алиасы</td>
</tr>

<tr>
<td class="org-left"><code>info</code></td>
<td class="org-left">Показать список локаций</td>
</tr>

<tr>
<td class="org-left"><code>help</code></td>
<td class="org-left">Показать справку</td>
</tr>

<tr>
<td class="org-left"><code>version</code></td>
<td class="org-left">Показать версию</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-orge461949" class="outline-3">
<h3 id="orge461949"><span class="section-number-3">6.1.</span> Подкоманды remote</h3>
<div class="outline-text-3" id="text-6-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Подкоманда</th>
<th scope="col" class="org-left">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>list</code></td>
<td class="org-left">Показать все доступные локации</td>
</tr>

<tr>
<td class="org-left"><code>add LOC-KEY</code></td>
<td class="org-left">Добавить remote во все репозитории</td>
</tr>

<tr>
<td class="org-left"><code>remove LOC-KEY</code></td>
<td class="org-left">Удалить remote из всех репозиториев</td>
</tr>

<tr>
<td class="org-left"><code>readd LOC-KEY</code></td>
<td class="org-left">Заново добавить remote во все репозитории</td>
</tr>

<tr>
<td class="org-left"><code>create LOC-KEY [--private]</code></td>
<td class="org-left">Создать репозиторий на провайдере</td>
</tr>

<tr>
<td class="org-left"><code>delete LOC-KEY</code></td>
<td class="org-left">Удалить репозиторий на провайдере</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orge092a64" class="outline-2">
<h2 id="orge092a64"><span class="section-number-2">7.</span> Тестирование</h2>
<div class="outline-text-2" id="text-7">
<p>
Запуск набора тестов:
</p>
<div class="org-src-container">
<pre class="src src-bash">sbcl --eval <span style="color: #79a8ff;">"(progn (require 'asdf) (asdf:load-system :cl-git-tree-tests) (uiop:symbol-call :cl-git-tree/tests :run-tests))"</span> --quit
</pre>
</div>

<p>
Ожидаемый результат: <code>Did 122 checks. Pass: 122 (100%). Skip: 0. Fail: 0.</code>
</p>
</div>
<div id="outline-container-org59b11bd" class="outline-3">
<h3 id="org59b11bd"><span class="section-number-3">7.1.</span> Покрытие тестами</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Система включает тесты для всех основных компонентов:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Модуль</th>
<th scope="col" class="org-left">Файл теста</th>
<th scope="col" class="org-left">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Locations</td>
<td class="org-left"><code>test-location.lisp</code></td>
<td class="org-left">API локаций: добавление, нормализация URL, определение провайдеров</td>
</tr>

<tr>
<td class="org-left">Dispatcher</td>
<td class="org-left"><code>test-dispatch.lisp</code></td>
<td class="org-left">Регистрация команд, диспетчеризация, обработка ошибок</td>
</tr>

<tr>
<td class="org-left">Commands</td>
<td class="org-left"><code>test-all-commands.lisp</code></td>
<td class="org-left">Проверка регистрации всех CLI-команд и подкоманд</td>
</tr>

<tr>
<td class="org-left">Shell Utils</td>
<td class="org-left"><code>test-shell-utils.lisp</code></td>
<td class="org-left">Парсинг SSH URL, разбор аргументов командной строки</td>
</tr>

<tr>
<td class="org-left">FS</td>
<td class="org-left"><code>test-fs.lisp</code></td>
<td class="org-left">Поиск git-репозиториев, проверка структуры</td>
</tr>

<tr>
<td class="org-left">Git Utils</td>
<td class="org-left"><code>test-git-utils.lisp</code></td>
<td class="org-left">Обёртки для git-команд</td>
</tr>

<tr>
<td class="org-left">Config</td>
<td class="org-left"><code>test-global.lisp</code>, <code>test-patterns.lisp</code></td>
<td class="org-left">Загрузка конфигурации, управление шаблонами файлов</td>
</tr>

<tr>
<td class="org-left">Commands</td>
<td class="org-left"><code>test-commands.lisp</code></td>
<td class="org-left">CLI-команды</td>
</tr>

<tr>
<td class="org-left">Workspace</td>
<td class="org-left"><code>workspace/*.lisp</code></td>
<td class="org-left">Создание и управление workspace-объектами</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org8e69e94" class="outline-2">
<h2 id="org8e69e94"><span class="section-number-2">8.</span> Разработка</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgdea9d23" class="outline-3">
<h3 id="orgdea9d23"><span class="section-number-3">8.1.</span> Структура проекта</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-nil">cl-git-tree/
├── src/
│   ├── cli.lisp                          # CLI точка входа
│   ├── config.lisp                       # Загрузка конфигурации
│   ├── package.lisp                      # Основной пакет
│   ├── commands/                         # 20+ CLI-команд
│   │   ├── clone.lisp, unclone.lisp      # Локальное клонирование
│   │   ├── clone-remote.lisp             # Удалённое клонирование
│   │   ├── remote-create.lisp            # Создание bare-репозиториев
│   │   ├── add.lisp, commit.lisp         # Git файловые операции
│   │   ├── pull.lisp, push.lisp          # Синхронизация
│   │   ├── remote-*.lisp                 # Управление remotes
│   │   ├── locations.lisp                # Управление локациями
│   │   ├── patterns.lisp                 # Управление шаблонами
│   │   ├── status.lisp, info.lisp        # Просмотр информации
│   │   └── aliases.lisp, all.lisp        # Утилиты
│   ├── dispatch/
│   │   └── dispatcher.lisp               # Реестр и диспетчер команд
│   ├── loc/
│   │   ├── defclass.lisp                 # Классы &lt;location&gt;, &lt;workspace&gt;
│   │   ├── provider.lisp                 # Классы провайдеров
│   │   ├── location.lisp                 # API для работы с локациями
│   │   ├── methods/                      # Методы для провайдеров
│   │   │   ├── remote-create.lisp
│   │   │   └── ...
│   │   └── package.lisp
│   ├── fs/
│   │   ├── fs.lisp                       # Утилиты файловой системы
│   │   └── package.lisp
│   ├── git-utils/
│   │   ├── git-utils.lisp                # Обёртки для git
│   │   └── package.lisp
│   ├── shell-utils/
│   │   ├── core.lisp, ssh-utils.lisp     # Shell-операции
│   │   └── package.lisp
│   ├── config/                           # Управление конфигурацией
│   │   ├── defaults.lisp
│   │   ├── file-patterns.lisp
│   │   └── package.lisp
│   └── global/
│       └── git-global.lisp               # Глобальные переменные git
├── tests/
│   ├── test-location.lisp                # Тесты для локаций
│   ├── test-global.lisp                  # Тесты конфигурации
│   ├── workspace/                        # Тесты для workspace
│   ├── test-*.lisp                       # Специализированные тесты
│   └── run.lisp                          # Запуск всех тестов
├── cl-git-tree.asd                       # Определение системы ASDF
├── cl-git-tree-tests.asd                 # Система тестов
└── README.org                            # Этот файл
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb078b11" class="outline-3">
<h3 id="orgb078b11"><span class="section-number-3">8.2.</span> Добавление новой команды</h3>
<div class="outline-text-3" id="text-8-2">
<ol class="org-ol">
<li>Создайте файл в <code>src/commands/your-command.lisp</code>:</li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #b6a0ff;">defpackage</span> <span style="color: #6ae4b9;">:cl-git-tree/commands/your-command</span>
  (<span style="color: #f78fe7;">:use</span> <span style="color: #f78fe7;">:cl</span> <span style="color: #f78fe7;">:cl-git-tree/loc</span> <span style="color: #f78fe7;">:cl-git-tree/dispatch</span>)
  (<span style="color: #f78fe7;">:export</span> cmd-your-command))

(<span style="color: #b6a0ff;">in-package</span> <span style="color: #f78fe7;">:cl-git-tree/commands/your-command</span>)

(<span style="color: #b6a0ff;">defun</span> <span style="color: #feacd0;">cmd-your-command</span> (<span style="color: #6ae4b9;">&amp;rest</span> args)
  <span style="color: #9ac8e0;">"&#1054;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1077; &#1074;&#1072;&#1096;&#1077;&#1081; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1099;."</span>
  (format t <span style="color: #79a8ff;">"&#1042;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1077; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1099; your-command &#1089; &#1072;&#1088;&#1075;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1084;&#1080;: ~A~%"</span> args))

<span style="color: #d8af7a;">;; </span><span style="color: #d8af7a;">&#1056;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1080;&#1088;&#1091;&#1077;&#1084; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1091; &#1074; &#1076;&#1080;&#1089;&#1087;&#1077;&#1090;&#1095;&#1077;&#1088;&#1077;
</span>(<span style="color: #b6a0ff;">eval-when</span> (<span style="color: #f78fe7;">:load-toplevel</span> <span style="color: #f78fe7;">:execute</span>)
  (register-command <span style="color: #79a8ff;">"your-command"</span> #'cmd-your-command <span style="color: #79a8ff;">"&#1054;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1077; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1099;"</span>))
</pre>
</div>

<ol class="org-ol">
<li>Добавьте загрузку модуля в <code>cl-git-tree.asd</code>:</li>
</ol>
<div class="org-src-container">
<pre class="src src-lisp">(<span style="color: #f78fe7;">:file</span> <span style="color: #79a8ff;">"commands/your-command"</span>)
</pre>
</div>

<ol class="org-ol">
<li>Команда будет автоматически доступна при загрузке системы.</li>
</ol>
</div>
</div>
<div id="outline-container-org75dfb24" class="outline-3">
<h3 id="org75dfb24"><span class="section-number-3">8.3.</span> Запуск тестов с покрытием</h3>
<div class="outline-text-3" id="text-8-3">
<p>
Для проверки кода перед коммитом:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #f78fe7;">cd</span> /home/mna/quicklisp/local-projects/clisp/cl-git-tree
sbcl --eval <span style="color: #79a8ff;">"(progn (require 'asdf) (asdf:load-system :cl-git-tree-tests) (uiop:symbol-call :cl-git-tree/tests :run-tests))"</span> --quit
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga0deb06" class="outline-2">
<h2 id="orga0deb06"><span class="section-number-2">9.</span> Лицензия</h2>
<div class="outline-text-2" id="text-9">
<p>
Проект распространяется под лицензией GNU GPL v3 или более поздней версии.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">&#1040;&#1074;&#1090;&#1086;&#1088;: Mykola Matvyeyev</p>
<p class="date">Created: 2025-12-05 Пт 23:16</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
