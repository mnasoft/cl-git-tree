#!/bin/bash
# Wrapper –¥–ª—è –∑–∞–ø—É—Å–∫–∞ cl-git-tree –≤ MSYS2

# –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ —ç—Ç–æ–º—É —Ñ–∞–π–ª—É
SCRIPT_FILE="${BASH_SOURCE[0]}"

# –ï—Å–ª–∏ —ç—Ç–æ —Å–∏–º–ª–∏–Ω–∫, —Ä–∞–∑—Ä–µ—à–∏—Ç—å –µ–≥–æ
if [ -L "$SCRIPT_FILE" ]; then
  SCRIPT_FILE="$(ls -l "$SCRIPT_FILE" | sed 's/.*-> //')"
  # –ï—Å–ª–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å, —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã–º
  if [[ "$SCRIPT_FILE" != /* ]]; then
    SCRIPT_FILE="$(dirname "${BASH_SOURCE[0]}")/$SCRIPT_FILE"
  fi
fi

SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_FILE")" && pwd)"
CLI_SCRIPT_LOCAL="$SCRIPT_DIR/cli-script.lisp"
CLI_SCRIPT_INSTALLED="/usr/local/lib/git-tree/cli-script.lisp"

# –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π cli-—Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: —Ä—è–¥–æ–º —Å –±–∏–Ω–∞—Ä—ë–º –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π
if [ -f "$CLI_SCRIPT_LOCAL" ]; then
  CLI_SCRIPT="$CLI_SCRIPT_LOCAL"
elif [ -f "$CLI_SCRIPT_INSTALLED" ]; then
  CLI_SCRIPT="$CLI_SCRIPT_INSTALLED"
else
  echo "‚ùå –û—à–∏–±–∫–∞: cli-—Å–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ $CLI_SCRIPT_LOCAL, –Ω–∏ –≤ $CLI_SCRIPT_INSTALLED"
  exit 1
fi

# –ù–∞–π—Ç–∏ SBCL –≤ PATH
SBCL=$(command -v sbcl 2>/dev/null)

if [ -z "$SBCL" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: SBCL –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ PATH"
  echo "üí° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pacman -S mingw-w64-ucrt64-sbcl"
  exit 1
fi

"$SBCL" --script "$CLI_SCRIPT" "$@"
